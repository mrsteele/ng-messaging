angular.module("ngMessaging",["ui.bootstrap"]),angular.module("ngMessaging").directive("ngMessagingArea",["ngMessagingManager",function(a){"use strict";return{replace:!0,transclude:!0,scope:{channel:"@"},templateUrl:"template/ng-messaging/messaging-area.html",link:function(b,c,d){b.closeError=function(){b.error=""},b.submit=function(){b.error="",b.submitting=!0;var c=a.addMsg(b);c.then(function(){b.msg=""},function(a){b.error=a}).then(function(){b.submitting=!1})}}}}]),angular.module("ngMessaging").directive("ngMessagingList",["ngMessagingManager",function(a){"use strict";return{replace:!0,transclude:!0,scope:{title:"@",channel:"@"},templateUrl:"template/ng-messaging/messaging-list.html",link:function(b,c,d){a.addChannel(d.channel).then(function(a){b.msgs=a},function(a){console.log(a)}),b.getTime=function(a){var b=new Date(a);return b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()},b.$watch(function(){return a.getChannelMsgs(d.channel)},function(a){b.msgs=a})}}}]),angular.module("ngMessaging").factory("ngMessagingManager",["NgMessagingMessage","$q",function(a,b){"use strict";function c(a){return void 0!==e[a]}var d={},e={},f=function(a){return b.reject("Message handler not set up.")},g=function(a){return b.reject("Sync handler not set up.")};return d.setMessageHandler=function(a){f=a},d.setSyncHandler=function(a){g=a},d.addChannel=function(a){return c(a)?b.resolve(e[a]):(e[a]=[],d.syncChannel(a))},d.getChannelMsgs=function(a){return c(a)?e[a]:[]},d.addMsg=function(d){if(d&&d.channel&&c(d.channel)){var g=f(d).then(function(b){e[d.channel].push(new a(b))});return g}return b.reject("Channel does not exist.")},d.syncChannel=function(b){var f,h;if(b)return c(b)||d.addChannel(b),h=g(b).then(function(c){if(e[b]=[],c&&c.length>0){for(f=0;f<c.length;f+=1)e[b].push(new a(c[f]));return e[b]}});h=[];for(f in e)e.hasOwnProperty(f)&&h.push(d.syncChannel(f));return h},d}]),angular.module("ngMessaging").factory("NgMessagingMessage",[function(){"use strict";var a,b=[];return a=function(a){angular.isString(a)&&(a={msg:a}),this.id=a.id||this.createId(),this.msg=a.msg,this.time=a.time||Date.now()},a.prototype.createId=function(){for(var a=0;-1!==b.indexOf(a);)a+=1;return b.push(a),a},a}]),angular.module("ngMessaging").run(["$templateCache",function(a){"use strict";a.put("template/ng-messaging/messaging-area.html",'<form ng-class="{\'has-error\': error.length}">\r\n    <textarea ng-model="msg" class="ng-messaging-area form-control" ng-disabled="submitting"></textarea>\r\n    <div class="help-block" ng-show="error.length">{{error}}</div>\r\n    <button class="btn" ng-click="submit()" ng-disabled="submitting">Submit</button>\r\n</form>\r\n'),a.put("template/ng-messaging/messaging-list.html",'<table class="table table-bordered messaging-list messaging-list-{{channel}}">\r\n    <thead ng-show="title">\r\n        <tr>\r\n            <th>{{title}}</th>\r\n        </tr>\r\n    </thead>\r\n    <tbody ng-show="msgs.length > 0">\r\n        <tr ng-repeat="msg in msgs">\r\n            <td>\r\n                {{msg.msg}}\r\n                <br clear="all" />\r\n                <small class="text-muted pull-right">\r\n                    Posted at {{getTime(msg.time)}}\r\n                </small>\r\n            </td>\r\n        </tr>\r\n    </tbody>\r\n    <tbody ng-show="msgs.length === 0">\r\n        <tr>\r\n            <td class="text-muted">\r\n               No messages.\r\n            </td>\r\n        </tr>\r\n    </tbody>\r\n</table>')}]);